!function($){var e=acf.Field.extend({type:"repeater",wait:"",events:{'click a[data-event="add-row"]':"onClickAdd",'click a[data-event="remove-row"]':"onClickRemove",'click a[data-event="collapse-row"]':"onClickCollapse",showField:"onShow",unloadField:"onUnload",mouseover:"onHover",unloadField:"onUnload"},$control:function(){return this.$(".acf-repeater:first")},$table:function(){return this.$("table:first")},$tbody:function(){return this.$("tbody:first")},$rows:function(){return this.$("tbody:first > tr").not(".acf-clone")},$row:function(e){return this.$("tbody:first > tr:eq("+e+")")},$clone:function(){return this.$("tbody:first > tr.acf-clone")},$actions:function(){return this.$(".acf-actions:last")},$button:function(){return this.$(".acf-actions:last .button")},getValue:function(){return this.$rows().length},allowRemove:function(){var e=parseInt(this.get("min"));return!e||e<this.val()},allowAdd:function(){var e=parseInt(this.get("max"));return!e||e>this.val()},addSortable:function(e){1!=this.get("max")&&this.$tbody().sortable({items:"> tr",handle:"> td.order",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,stop:function(t,n){e.render()},update:function(t,n){e.$input().trigger("change")}})},addCollapsed:function(){var e=t.load(this.get("key"));if(!e)return!1;this.$rows().each(function(t){e.indexOf(t)>-1&&$(this).addClass("-collapsed")})},addUnscopedEvents:function(e){this.on("invalidField",".acf-row",function(t){var n=$(this);e.isCollapsed(n)&&e.expand(n)})},initialize:function(){this.addUnscopedEvents(this),this.addCollapsed(),acf.disable(this.$clone(),this.cid),this.render()},render:function(){this.$rows().each(function(e){$(this).find("> .order > span").html(e+1)}),0==this.val()?this.$control().addClass("-empty"):this.$control().removeClass("-empty"),this.allowAdd()?this.$button().removeClass("disabled"):this.$button().addClass("disabled")},validateAdd:function(){if(this.allowAdd())return!0;var e=this.get("max"),t=acf.__("Maximum rows reached ({max} rows)");return t=t.replace("{max}",e),this.showNotice({text:t,type:"warning"}),!1},onClickAdd:function(e,t){if(!this.validateAdd())return!1;t.hasClass("acf-icon")?this.add({before:t.closest(".acf-row")}):this.add()},add:function(e){if(!this.allowAdd())return!1;e=acf.parseArgs(e,{before:!1});var t=acf.duplicate({target:this.$clone(),append:this.proxy(function(t,n){e.before?e.before.before(n):t.before(n),n.removeClass("acf-clone"),acf.enable(n,this.cid),this.render()})});return this.$input().trigger("change"),t},validateRemove:function(){if(this.allowRemove())return!0;var e=this.get("min"),t=acf.__("Minimum rows reached ({min} rows)");return t=t.replace("{min}",e),this.showNotice({text:t,type:"warning"}),!1},onClickRemove:function(e,t){var n=t.closest(".acf-row");n.addClass("-hover");var i=acf.newTooltip({confirmRemove:!0,target:t,context:this,confirm:function(){this.remove(n)},cancel:function(){n.removeClass("-hover")}})},remove:function(e){var t=this;acf.remove({target:e,endHeight:0,complete:function(){t.$input().trigger("change"),t.render()}})},isCollapsed:function(e){return e.hasClass("-collapsed")},collapse:function(e){e.addClass("-collapsed"),acf.doAction("hide",e,"collapse")},expand:function(e){e.removeClass("-collapsed"),acf.doAction("show",e,"collapse")},onClickCollapse:function(e,t){var n=t.closest(".acf-row"),i=this.isCollapsed(n);e.shiftKey&&(n=this.$rows()),i?this.expand(n):this.collapse(n)},onShow:function(e,t,n){var i=acf.getFields({is:":visible",parent:this.$el});acf.doAction("show_fields",i)},onUnload:function(){var e=[];this.$rows().each(function(t){$(this).hasClass("-collapsed")&&e.push(t)}),e=e.length?e:null,t.save(this.get("key"),e)},onHover:function(){this.addSortable(this),this.off("mouseover")}});acf.registerFieldType(e),acf.registerConditionForFieldType("hasValue","repeater"),acf.registerConditionForFieldType("hasNoValue","repeater"),acf.registerConditionForFieldType("lessThan","repeater"),acf.registerConditionForFieldType("greaterThan","repeater");var t=new acf.Model({name:"this.collapsedRows",key:function(e,t){var n=this.get(e+t)||0;return n++,this.set(e+t,n,!0),n>1&&(e+="-"+n),e},load:function(e){var e=this.key(e,"load"),t=acf.getPreference(this.name);return!(!t||!t[e])&&t[e]},save:function(e,t){var e=this.key(e,"save"),n=acf.getPreference(this.name)||{};null===t?delete n[e]:n[e]=t,$.isEmptyObject(n)&&(n=null),acf.setPreference(this.name,n)}})}(jQuery);